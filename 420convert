#!/usr/bin/env python3
import os
import sys
import subprocess
import argparse
from pathlib import Path

class VideoConverter:
    def __init__(self):
        self.formats = ["mp4", "avi", "mov", "mkv", "webm", "flv", "wmv"]
        
    def show_banner(self):
        banner = """
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    ðŸŽ¬ 420 VIDEO CONVERTER ðŸŽ¬                 â•‘
â•‘                                                              â•‘
â•‘              Professional CLI Video Conversion Tool          â•‘
â•‘                        Made for Creators                     â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        """
        print(banner)
    
    def show_help(self):
        help_text = """
ðŸš€ USAGE:
  420convert video.avi mp4              # Convert to MP4
  420convert movie.mov webm             # Convert to WebM
  420convert batch *.mp4 avi            # Convert all MP4 to AVI

ðŸŽ¯ FORMATS: mp4, avi, mov, mkv, webm

âš¡ MORE: --formats --version --help
        """
        print(help_text)
    
    def show_formats(self):
        print("\nðŸŽ¯ SUPPORTED FORMATS:")
        print("â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”")
        print("â”‚   FORMAT    â”‚              DESCRIPTION            â”‚")
        print("â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤")
        print("â”‚     MP4     â”‚  Most compatible, good quality      â”‚")
        print("â”‚     AVI     â”‚  High quality, larger file size     â”‚")
        print("â”‚     MOV     â”‚  Apple format, good for editing     â”‚")
        print("â”‚     MKV     â”‚  Open source, supports subtitles    â”‚")
        print("â”‚    WebM     â”‚  Web optimized, smaller size        â”‚")
        print("â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜")
    
    def convert_video(self, input_file, output_file):
        if not os.path.exists(input_file):
            print(f"âŒ Error: Input file '{input_file}' not found!")
            return False
        
        print(f"\nðŸ”„ Converting: {input_file}")
        print(f"ðŸ“ Output: {output_file}")
        print("â³ Processing... (this may take a while)")
        
        try:
            cmd = ["ffmpeg", "-i", input_file, "-y", output_file, "-loglevel", "error", "-stats"]
            result = subprocess.run(cmd)
            
            if result.returncode == 0:
                file_size = os.path.getsize(output_file) / (1024*1024)
                print(f"\nâœ… Conversion successful!")
                print(f"ðŸ“Š Output size: {file_size:.1f} MB")
                print(f"ðŸ’¾ Saved as: {output_file}")
                return True
            else:
                print(f"\nâŒ Conversion failed!")
                return False
                
        except FileNotFoundError:
            print("âŒ Error: ffmpeg not found! Please install ffmpeg first.")
            print("   sudo pacman -S ffmpeg  # Arch Linux")
            print("   sudo apt install ffmpeg  # Ubuntu/Debian")
            return False
    
    def batch_convert(self, pattern, output_format):
        import glob
        files = glob.glob(pattern)
        
        if not files:
            print(f"âŒ No files found matching: {pattern}")
            return
        
        print(f"\nðŸ”„ Batch converting {len(files)} files to {output_format.upper()}")
        
        success_count = 0
        for i, file in enumerate(files, 1):
            input_path = Path(file)
            output_file = f"{input_path.stem}_converted.{output_format}"
            
            print(f"\n[{i}/{len(files)}] Converting: {input_path.name}")
            
            if self.convert_video(file, output_file):
                success_count += 1
        
        print(f"\nðŸŽ‰ Batch conversion complete!")
        print(f"âœ… Successfully converted: {success_count}/{len(files)} files")
    
    def run(self):
        if len(sys.argv) == 1:
            self.show_banner()
            self.show_help()
            return
        
        # Handle special commands
        if "--help" in sys.argv or "-h" in sys.argv:
            self.show_banner()
            self.show_help()
            return
        
        if "--formats" in sys.argv:
            self.show_formats()
            return
        
        if "--version" in sys.argv:
            print("420convert v1.0.0 - Professional Video Converter")
            return
        
        # Handle batch conversion
        if len(sys.argv) >= 4 and sys.argv[1] == "batch":
            pattern = sys.argv[2]
            output_format = sys.argv[3]
            self.batch_convert(pattern, output_format)
            return
        
        # Handle regular conversion
        if len(sys.argv) < 3:
            print("âŒ Error: Not enough arguments!")
            print("ðŸ’¡ Usage: 420convert <input_file> <output_format>")
            print("ðŸ’¡ Type '420convert --help' for more info")
            return
        
        input_file = sys.argv[1]
        second_arg = sys.argv[2]
        
        # Check if second argument is format or full filename
        if second_arg.lower() in self.formats:
            # Format specified, generate output filename
            input_path = Path(input_file)
            output_file = f"{input_path.stem}_converted.{second_arg}"
        else:
            # Full output filename specified
            output_file = second_arg
        
        self.show_banner()
        self.convert_video(input_file, output_file)

if __name__ == "__main__":
    converter = VideoConverter()
    converter.run()
